{"ast":null,"code":"var _jsxFileName = \"/Users/dongbingfeng/code/cursor_learn/nail-segmentation/frontend/src/components/LabelingInterface.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport ImageCanvas from './ImageCanvas';\nimport ToolPalette from './ToolPalette';\nimport { useImageNavigation } from '../contexts/ImageNavigationContext';\nimport { samService } from '../services/samService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst LabelingInterface = () => {\n  _s();\n  const [selectedTool, setSelectedTool] = useState('select');\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [samPoints, setSamPoints] = useState([]);\n  const [maskPoints, setMaskPoints] = useState([]);\n  const {\n    currentImageData,\n    annotations,\n    updateAnnotations,\n    saveCurrentAnnotations,\n    isLoading,\n    error\n  } = useImageNavigation();\n\n  // Auto-save annotations when they change\n  useEffect(() => {\n    const autoSaveTimer = setTimeout(() => {\n      if (annotations.length > 0) {\n        saveCurrentAnnotations(annotations);\n      }\n    }, 2000); // Auto-save after 2 seconds of inactivity\n\n    return () => clearTimeout(autoSaveTimer);\n  }, [annotations, saveCurrentAnnotations]);\n  const handleToolSelect = tool => {\n    setSelectedTool(tool);\n  };\n  const handleAnnotationCreate = async annotationData => {\n    if (!currentImageData) return;\n    try {\n      // Generate temporary ID for now - will be replaced with API response\n      const newAnnotation = {\n        ...annotationData,\n        id: `temp-${Date.now()}`,\n        imageId: currentImageData.id,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n      const updatedAnnotations = [...annotations, newAnnotation];\n      updateAnnotations(updatedAnnotations);\n      console.log('Created annotation:', newAnnotation);\n    } catch (err) {\n      console.error('Error creating annotation:', err);\n    }\n  };\n  const handleAnnotationUpdate = async (id, updates) => {\n    try {\n      const updatedAnnotations = annotations.map(annotation => annotation.id === id ? {\n        ...annotation,\n        ...updates,\n        updatedAt: new Date().toISOString()\n      } : annotation);\n      updateAnnotations(updatedAnnotations);\n      console.log('Updated annotation:', id, updates);\n    } catch (err) {\n      console.error('Error updating annotation:', err);\n    }\n  };\n  const handleAnnotationDelete = async id => {\n    try {\n      const updatedAnnotations = annotations.filter(annotation => annotation.id !== id);\n      updateAnnotations(updatedAnnotations);\n      console.log('Deleted annotation:', id);\n    } catch (err) {\n      console.error('Error deleting annotation:', err);\n    }\n  };\n  const handleSamPointClick = (point, label = 1) => {\n    // Add point to SAM points collection\n    setSamPoints(prev => [...prev, {\n      ...point,\n      label\n    }]);\n  };\n  const handleClearSamPoints = () => {\n    setSamPoints([]);\n    setMaskPoints([]);\n  };\n  const handleSamProcess = async () => {\n    if (!currentImageData || samPoints.length === 0) {\n      console.warn('No image or SAM points available');\n      return;\n    }\n\n    // Find a bounding box from existing annotations or create a default one\n    let boundingBox = {\n      topLeft: {\n        x: 0,\n        y: 0\n      },\n      bottomRight: {\n        x: currentImageData.width,\n        y: currentImageData.height\n      }\n    };\n\n    // Use the first bounding box annotation if available\n    const bboxAnnotation = annotations.find(ann => ann.type === 'bounding_box');\n    if (bboxAnnotation && bboxAnnotation.coordinates.width && bboxAnnotation.coordinates.height) {\n      boundingBox = {\n        topLeft: {\n          x: bboxAnnotation.coordinates.x,\n          y: bboxAnnotation.coordinates.y\n        },\n        bottomRight: {\n          x: bboxAnnotation.coordinates.x + bboxAnnotation.coordinates.width,\n          y: bboxAnnotation.coordinates.y + bboxAnnotation.coordinates.height\n        }\n      };\n    }\n    setIsProcessing(true);\n    try {\n      console.log('Processing with SAM...', {\n        imageId: currentImageData.id,\n        boundingBox,\n        points: samPoints\n      });\n\n      // Prepare SAM request with new interface\n      const samRequest = {\n        imageId: currentImageData.id,\n        boundingBox,\n        points: samPoints.map(p => ({\n          x: p.x,\n          y: p.y\n        })),\n        labels: samPoints.map(p => p.label)\n      };\n\n      // Call real SAM service\n      const result = await samService.processSegmentation(samRequest);\n      if (result.success) {\n        // Handle mask_points if they exist in the response\n        if (result.mask_points && result.mask_points.length > 0) {\n          console.log('Received mask points:', result.mask_points);\n          setMaskPoints(result.mask_points);\n        } else {\n          setMaskPoints([]); // Clear existing mask points if none received\n        }\n        // Show mask points details in a dialog\n        if (result.mask_points && result.mask_points.length > 0) {\n          const maskPointsCount = result.mask_points.length;\n          const dialogContent = /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Mask Points Details\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 155,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Total mask points: \", maskPointsCount]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 156,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"First 5 points: \", result.mask_points.slice(0, 5).map((point, i) => `(${point.x}, ${point.y})${i < 4 ? ', ' : ''}`)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Last 5 points: \", result.mask_points.slice(-5).map((point, i) => `(${point.x}, ${point.y})${i < 4 ? ', ' : ''}`)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 13\n          }, this);\n\n          // Show dialog using the existing dialog system\n          const dialog = document.createElement('div');\n          dialog.style.position = 'fixed';\n          dialog.style.top = '50%';\n          dialog.style.left = '50%';\n          dialog.style.transform = 'translate(-50%, -50%)';\n          dialog.style.backgroundColor = 'white';\n          dialog.style.padding = '20px';\n          dialog.style.borderRadius = '8px';\n          dialog.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';\n          dialog.style.zIndex = '1000';\n          dialog.innerHTML = dialogContent.props.children.map(child => child.props.children).join('');\n          const closeButton = document.createElement('button');\n          closeButton.textContent = 'Close';\n          closeButton.style.marginTop = '10px';\n          closeButton.style.padding = '5px 10px';\n          closeButton.onclick = () => document.body.removeChild(dialog);\n          dialog.appendChild(closeButton);\n          document.body.appendChild(dialog);\n        }\n        // Convert SAM masks to annotations if they exist\n        if (result.masks.length > 0) {\n          result.masks.forEach((mask, index) => {\n            const samAnnotation = {\n              id: `sam-${Date.now()}-${index}`,\n              imageId: currentImageData.id,\n              type: 'segmentation',\n              coordinates: {\n                x: Math.min(...mask.points.map(p => p.x)),\n                y: Math.min(...mask.points.map(p => p.y)),\n                points: mask.points\n              },\n              label: `sam-nail-${annotations.length + index + 1}`,\n              confidence: mask.confidence,\n              createdAt: new Date().toISOString(),\n              updatedAt: new Date().toISOString()\n            };\n            const updatedAnnotations = [...annotations, samAnnotation];\n            updateAnnotations(updatedAnnotations);\n          });\n        }\n\n        // Clear SAM points after successful processing\n        setSamPoints([]);\n        console.log('SAM processing completed successfully');\n      } else {\n        // Clear mask points on failure\n        setMaskPoints([]);\n        console.error('SAM processing failed:', result.error);\n        alert(`SAM processing failed: ${result.error || 'Unknown error'}`);\n      }\n    } catch (err) {\n      console.error('Error processing with SAM:', err);\n      alert(`SAM processing error: ${err instanceof Error ? err.message : 'Unknown error'}`);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        height: '400px',\n        backgroundColor: '#f5f5f5',\n        borderRadius: '8px'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"Loading image...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 7\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: '2rem',\n        textAlign: 'center',\n        backgroundColor: '#ffebee',\n        color: '#c62828',\n        borderRadius: '8px',\n        border: '1px solid #ef5350'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Error\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => window.location.reload(),\n        style: {\n          padding: '0.5rem 1rem',\n          backgroundColor: '#1976d2',\n          color: 'white',\n          border: 'none',\n          borderRadius: '4px',\n          cursor: 'pointer'\n        },\n        children: \"Retry\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 7\n    }, this);\n  }\n  if (!currentImageData) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: '2rem',\n        textAlign: 'center',\n        backgroundColor: '#f5f5f5',\n        borderRadius: '8px'\n      },\n      children: \"No image data available\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      gap: '1rem',\n      padding: '1rem',\n      height: '100vh',\n      overflow: 'hidden'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: '300px',\n        flexShrink: 0,\n        display: 'flex',\n        flexDirection: 'column',\n        height: '100%'\n      },\n      children: [/*#__PURE__*/_jsxDEV(ToolPalette, {\n        selectedTool: selectedTool,\n        onToolSelect: handleToolSelect,\n        onSamProcess: handleSamProcess,\n        onClearSamPoints: handleClearSamPoints,\n        isProcessing: isProcessing,\n        samPointsCount: samPoints.length\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          backgroundColor: '#f8f9fa',\n          borderRadius: '8px',\n          padding: '1rem',\n          boxShadow: '0 2px 4px rgba(0,0,0,0.1)',\n          flex: 1,\n          minHeight: 0,\n          display: 'flex',\n          flexDirection: 'column'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            margin: '0 0 1rem 0',\n            fontSize: '1.1rem',\n            color: '#333'\n          },\n          children: [\"Annotations (\", annotations.length, \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 11\n        }, this), annotations.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#666',\n            fontSize: '0.9rem',\n            margin: 0\n          },\n          children: \"No annotations yet. Use the tools above to create some.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            flex: 1,\n            overflowY: 'auto',\n            minHeight: 0\n          },\n          children: annotations.map((annotation, index) => {\n            var _annotation$coordinat;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                padding: '0.5rem',\n                marginBottom: '0.5rem',\n                backgroundColor: '#fff',\n                borderRadius: '4px',\n                border: '1px solid #ddd',\n                fontSize: '0.9rem'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontWeight: 'bold',\n                  marginBottom: '0.25rem'\n                },\n                children: [annotation.type === 'bounding_box' ? 'ðŸ“¦' : 'ðŸŽ¯', \" \", annotation.label]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 355,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  color: '#666',\n                  fontSize: '0.8rem'\n                },\n                children: [annotation.type === 'bounding_box' ? `${Math.round(annotation.coordinates.x)}, ${Math.round(annotation.coordinates.y)} - ${Math.round(annotation.coordinates.width || 0)}Ã—${Math.round(annotation.coordinates.height || 0)}` : `${((_annotation$coordinat = annotation.coordinates.points) === null || _annotation$coordinat === void 0 ? void 0 : _annotation$coordinat.length) || 0} points`, annotation.confidence && /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [\" (conf: \", Math.round(annotation.confidence * 100), \"%)\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 364,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 358,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => handleAnnotationDelete(annotation.id),\n                style: {\n                  marginTop: '0.25rem',\n                  padding: '0.25rem 0.5rem',\n                  backgroundColor: '#ff4444',\n                  color: 'white',\n                  border: 'none',\n                  borderRadius: '3px',\n                  fontSize: '0.8rem',\n                  cursor: 'pointer'\n                },\n                children: \"Delete\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 367,\n                columnNumber: 19\n              }, this)]\n            }, annotation.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 344,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        flex: 1,\n        display: 'flex',\n        flexDirection: 'column',\n        height: '100%',\n        minWidth: 0\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginBottom: '1rem',\n          padding: '0.75rem 1rem',\n          backgroundColor: '#e3f2fd',\n          borderRadius: '6px',\n          border: '1px solid #1976d2',\n          flexShrink: 0\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          style: {\n            margin: '0 0 0.5rem 0',\n            color: '#1976d2'\n          },\n          children: currentImageData.filename\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            margin: 0,\n            fontSize: '0.9rem',\n            color: '#1565c0'\n          },\n          children: [\"Current tool: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: selectedTool.replace('_', ' ').toUpperCase()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 409,\n            columnNumber: 27\n          }, this), \" | Image: \", currentImageData.width, \"\\xD7\", currentImageData.height, \"px\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          flex: 1,\n          overflow: 'auto',\n          minHeight: 0,\n          border: '1px solid #ddd',\n          borderRadius: '8px',\n          backgroundColor: '#f9f9f9'\n        },\n        children: /*#__PURE__*/_jsxDEV(ImageCanvas, {\n          imageUrl: currentImageData.url,\n          annotations: annotations,\n          selectedTool: selectedTool,\n          onAnnotationCreate: handleAnnotationCreate,\n          onAnnotationUpdate: handleAnnotationUpdate,\n          onAnnotationDelete: handleAnnotationDelete,\n          onSamPointClick: handleSamPointClick,\n          samPoints: samPoints,\n          maskPoints: maskPoints\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 421,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 286,\n    columnNumber: 5\n  }, this);\n};\n_s(LabelingInterface, \"OxJmcn/hmuUFuccragpymh9ZjMI=\", false, function () {\n  return [useImageNavigation];\n});\n_c = LabelingInterface;\nexport default LabelingInterface;\nvar _c;\n$RefreshReg$(_c, \"LabelingInterface\");","map":{"version":3,"names":["React","useState","useEffect","ImageCanvas","ToolPalette","useImageNavigation","samService","jsxDEV","_jsxDEV","LabelingInterface","_s","selectedTool","setSelectedTool","isProcessing","setIsProcessing","samPoints","setSamPoints","maskPoints","setMaskPoints","currentImageData","annotations","updateAnnotations","saveCurrentAnnotations","isLoading","error","autoSaveTimer","setTimeout","length","clearTimeout","handleToolSelect","tool","handleAnnotationCreate","annotationData","newAnnotation","id","Date","now","imageId","createdAt","toISOString","updatedAt","updatedAnnotations","console","log","err","handleAnnotationUpdate","updates","map","annotation","handleAnnotationDelete","filter","handleSamPointClick","point","label","prev","handleClearSamPoints","handleSamProcess","warn","boundingBox","topLeft","x","y","bottomRight","width","height","bboxAnnotation","find","ann","type","coordinates","points","samRequest","p","labels","result","processSegmentation","success","mask_points","maskPointsCount","dialogContent","children","fileName","_jsxFileName","lineNumber","columnNumber","slice","i","dialog","document","createElement","style","position","top","left","transform","backgroundColor","padding","borderRadius","boxShadow","zIndex","innerHTML","props","child","join","closeButton","textContent","marginTop","onclick","body","removeChild","appendChild","masks","forEach","mask","index","samAnnotation","Math","min","confidence","alert","Error","message","display","justifyContent","alignItems","textAlign","color","border","onClick","window","location","reload","cursor","gap","overflow","flexShrink","flexDirection","onToolSelect","onSamProcess","onClearSamPoints","samPointsCount","flex","minHeight","margin","fontSize","overflowY","_annotation$coordinat","marginBottom","fontWeight","round","minWidth","filename","replace","toUpperCase","imageUrl","url","onAnnotationCreate","onAnnotationUpdate","onAnnotationDelete","onSamPointClick","_c","$RefreshReg$"],"sources":["/Users/dongbingfeng/code/cursor_learn/nail-segmentation/frontend/src/components/LabelingInterface.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport ImageCanvas from './ImageCanvas';\nimport ToolPalette from './ToolPalette';\nimport { useImageNavigation } from '../contexts/ImageNavigationContext';\nimport { Annotation, SAMRequest } from '../types/annotations';\nimport { samService } from '../services/samService';\n\nconst LabelingInterface: React.FC = () => {\n  const [selectedTool, setSelectedTool] = useState<'select' | 'bounding_box' | 'sam_point'>('select');\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [samPoints, setSamPoints] = useState<Array<{x: number, y: number, label: number}>>([]);\n  const [maskPoints, setMaskPoints] = useState<Array<{x: number, y: number}>>([]);\n  \n  const {\n    currentImageData,\n    annotations,\n    updateAnnotations,\n    saveCurrentAnnotations,\n    isLoading,\n    error\n  } = useImageNavigation();\n\n  // Auto-save annotations when they change\n  useEffect(() => {\n    const autoSaveTimer = setTimeout(() => {\n      if (annotations.length > 0) {\n        saveCurrentAnnotations(annotations);\n      }\n    }, 2000); // Auto-save after 2 seconds of inactivity\n\n    return () => clearTimeout(autoSaveTimer);\n  }, [annotations, saveCurrentAnnotations]);\n\n  const handleToolSelect = (tool: string) => {\n    setSelectedTool(tool as 'select' | 'bounding_box' | 'sam_point');\n  };\n\n  const handleAnnotationCreate = async (annotationData: Omit<Annotation, 'id' | 'createdAt' | 'updatedAt'>) => {\n    if (!currentImageData) return;\n    \n    try {\n      // Generate temporary ID for now - will be replaced with API response\n      const newAnnotation: Annotation = {\n        ...annotationData,\n        id: `temp-${Date.now()}`,\n        imageId: currentImageData.id,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n      };\n\n      const updatedAnnotations = [...annotations, newAnnotation];\n      updateAnnotations(updatedAnnotations);\n      \n      console.log('Created annotation:', newAnnotation);\n    } catch (err) {\n      console.error('Error creating annotation:', err);\n    }\n  };\n\n  const handleAnnotationUpdate = async (id: string, updates: Partial<Annotation>) => {\n    try {\n      const updatedAnnotations = annotations.map(annotation => \n        annotation.id === id \n          ? { ...annotation, ...updates, updatedAt: new Date().toISOString() }\n          : annotation\n      );\n      \n      updateAnnotations(updatedAnnotations);\n      console.log('Updated annotation:', id, updates);\n    } catch (err) {\n      console.error('Error updating annotation:', err);\n    }\n  };\n\n  const handleAnnotationDelete = async (id: string) => {\n    try {\n      const updatedAnnotations = annotations.filter(annotation => annotation.id !== id);\n      updateAnnotations(updatedAnnotations);\n      \n      console.log('Deleted annotation:', id);\n    } catch (err) {\n      console.error('Error deleting annotation:', err);\n    }\n  };\n\n  const handleSamPointClick = (point: {x: number, y: number}, label: number = 1) => {\n    // Add point to SAM points collection\n    setSamPoints(prev => [...prev, { ...point, label }]);\n  };\n\n  const handleClearSamPoints = () => {\n    setSamPoints([]);\n    setMaskPoints([]);\n  };\n\n  const handleSamProcess = async () => {\n    if (!currentImageData || samPoints.length === 0) {\n      console.warn('No image or SAM points available');\n      return;\n    }\n\n    // Find a bounding box from existing annotations or create a default one\n    let boundingBox = {\n      topLeft: { x: 0, y: 0 },\n      bottomRight: { x: currentImageData.width, y: currentImageData.height }\n    };\n\n    // Use the first bounding box annotation if available\n    const bboxAnnotation = annotations.find(ann => ann.type === 'bounding_box');\n    if (bboxAnnotation && bboxAnnotation.coordinates.width && bboxAnnotation.coordinates.height) {\n      boundingBox = {\n        topLeft: { \n          x: bboxAnnotation.coordinates.x, \n          y: bboxAnnotation.coordinates.y \n        },\n        bottomRight: { \n          x: bboxAnnotation.coordinates.x + bboxAnnotation.coordinates.width,\n          y: bboxAnnotation.coordinates.y + bboxAnnotation.coordinates.height\n        }\n      };\n    }\n\n    setIsProcessing(true);\n    try {\n      console.log('Processing with SAM...', { \n        imageId: currentImageData.id, \n        boundingBox,\n        points: samPoints \n      });\n      \n      // Prepare SAM request with new interface\n      const samRequest: SAMRequest = {\n        imageId: currentImageData.id,\n        boundingBox,\n        points: samPoints.map(p => ({ x: p.x, y: p.y })),\n        labels: samPoints.map(p => p.label)\n      };\n\n      // Call real SAM service\n      const result = await samService.processSegmentation(samRequest);\n      \n      if (result.success) {\n        // Handle mask_points if they exist in the response\n        if (result.mask_points && result.mask_points.length > 0) {\n          console.log('Received mask points:', result.mask_points);\n          setMaskPoints(result.mask_points);\n        } else {\n          setMaskPoints([]); // Clear existing mask points if none received\n        }\n        // Show mask points details in a dialog\n        if (result.mask_points && result.mask_points.length > 0) {\n          const maskPointsCount = result.mask_points.length;\n          const dialogContent = (\n            <div>\n              <h3>Mask Points Details</h3>\n              <p>Total mask points: {maskPointsCount}</p>\n              <p>First 5 points: {result.mask_points.slice(0, 5).map((point, i) => \n                `(${point.x}, ${point.y})${i < 4 ? ', ' : ''}`\n              )}</p>\n              <p>Last 5 points: {result.mask_points.slice(-5).map((point, i) => \n                `(${point.x}, ${point.y})${i < 4 ? ', ' : ''}`\n              )}</p>\n            </div>\n          );\n\n          // Show dialog using the existing dialog system\n        const dialog = document.createElement('div');\n        dialog.style.position = 'fixed';\n        dialog.style.top = '50%';\n        dialog.style.left = '50%';\n        dialog.style.transform = 'translate(-50%, -50%)';\n        dialog.style.backgroundColor = 'white';\n        dialog.style.padding = '20px';\n        dialog.style.borderRadius = '8px';\n        dialog.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';\n        dialog.style.zIndex = '1000';\n        dialog.innerHTML = dialogContent.props.children.map(child => child.props.children).join('');\n        \n        const closeButton = document.createElement('button');\n        closeButton.textContent = 'Close';\n        closeButton.style.marginTop = '10px';\n        closeButton.style.padding = '5px 10px';\n        closeButton.onclick = () => document.body.removeChild(dialog);\n        \n        dialog.appendChild(closeButton);\n        document.body.appendChild(dialog);\n        }\n        // Convert SAM masks to annotations if they exist\n        if (result.masks.length > 0) {\n          result.masks.forEach((mask, index) => {\n            const samAnnotation: Annotation = {\n              id: `sam-${Date.now()}-${index}`,\n              imageId: currentImageData.id,\n              type: 'segmentation',\n              coordinates: {\n                x: Math.min(...mask.points.map(p => p.x)),\n                y: Math.min(...mask.points.map(p => p.y)),\n                points: mask.points,\n              },\n              label: `sam-nail-${annotations.length + index + 1}`,\n              confidence: mask.confidence,\n              createdAt: new Date().toISOString(),\n              updatedAt: new Date().toISOString(),\n            };\n            \n            const updatedAnnotations = [...annotations, samAnnotation];\n            updateAnnotations(updatedAnnotations);\n          });\n        }\n\n        // Clear SAM points after successful processing\n        setSamPoints([]);\n        console.log('SAM processing completed successfully');\n      } else {\n        // Clear mask points on failure\n        setMaskPoints([]);\n        console.error('SAM processing failed:', result.error);\n        alert(`SAM processing failed: ${result.error || 'Unknown error'}`);\n      }\n    } catch (err) {\n      console.error('Error processing with SAM:', err);\n      alert(`SAM processing error: ${err instanceof Error ? err.message : 'Unknown error'}`);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div style={{ \n        display: 'flex', \n        justifyContent: 'center', \n        alignItems: 'center', \n        height: '400px',\n        backgroundColor: '#f5f5f5',\n        borderRadius: '8px'\n      }}>\n        <div>Loading image...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div style={{ \n        padding: '2rem', \n        textAlign: 'center',\n        backgroundColor: '#ffebee',\n        color: '#c62828',\n        borderRadius: '8px',\n        border: '1px solid #ef5350'\n      }}>\n        <h3>Error</h3>\n        <p>{error}</p>\n        <button \n          onClick={() => window.location.reload()}\n          style={{\n            padding: '0.5rem 1rem',\n            backgroundColor: '#1976d2',\n            color: 'white',\n            border: 'none',\n            borderRadius: '4px',\n            cursor: 'pointer'\n          }}\n        >\n          Retry\n        </button>\n      </div>\n    );\n  }\n\n  if (!currentImageData) {\n    return (\n      <div style={{ \n        padding: '2rem', \n        textAlign: 'center',\n        backgroundColor: '#f5f5f5',\n        borderRadius: '8px'\n      }}>\n        No image data available\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ \n      display: 'flex', \n      gap: '1rem', \n      padding: '1rem',\n      height: '100vh',\n      overflow: 'hidden'\n    }}>\n      {/* Left Panel - Tools */}\n      <div style={{ \n        width: '300px', \n        flexShrink: 0,\n        display: 'flex',\n        flexDirection: 'column',\n        height: '100%'\n      }}>\n        <ToolPalette\n          selectedTool={selectedTool}\n          onToolSelect={handleToolSelect}\n          onSamProcess={handleSamProcess}\n          onClearSamPoints={handleClearSamPoints}\n          isProcessing={isProcessing}\n          samPointsCount={samPoints.length}\n        />\n        \n        {/* Annotations List */}\n        <div style={{\n          backgroundColor: '#f8f9fa',\n          borderRadius: '8px',\n          padding: '1rem',\n          boxShadow: '0 2px 4px rgba(0,0,0,0.1)',\n          flex: 1,\n          minHeight: 0,\n          display: 'flex',\n          flexDirection: 'column'\n        }}>\n          <h3 style={{ \n            margin: '0 0 1rem 0', \n            fontSize: '1.1rem', \n            color: '#333' \n          }}>\n            Annotations ({annotations.length})\n          </h3>\n          \n          {annotations.length === 0 ? (\n            <p style={{ \n              color: '#666', \n              fontSize: '0.9rem',\n              margin: 0 \n            }}>\n              No annotations yet. Use the tools above to create some.\n            </p>\n          ) : (\n            <div style={{ \n              flex: 1,\n              overflowY: 'auto',\n              minHeight: 0\n            }}>\n              {annotations.map((annotation, index) => (\n                <div \n                  key={annotation.id}\n                  style={{\n                    padding: '0.5rem',\n                    marginBottom: '0.5rem',\n                    backgroundColor: '#fff',\n                    borderRadius: '4px',\n                    border: '1px solid #ddd',\n                    fontSize: '0.9rem'\n                  }}\n                >\n                  <div style={{ fontWeight: 'bold', marginBottom: '0.25rem' }}>\n                    {annotation.type === 'bounding_box' ? 'ðŸ“¦' : 'ðŸŽ¯'} {annotation.label}\n                  </div>\n                  <div style={{ color: '#666', fontSize: '0.8rem' }}>\n                    {annotation.type === 'bounding_box' \n                      ? `${Math.round(annotation.coordinates.x)}, ${Math.round(annotation.coordinates.y)} - ${Math.round(annotation.coordinates.width || 0)}Ã—${Math.round(annotation.coordinates.height || 0)}`\n                      : `${annotation.coordinates.points?.length || 0} points`\n                    }\n                    {annotation.confidence && (\n                      <span> (conf: {Math.round(annotation.confidence * 100)}%)</span>\n                    )}\n                  </div>\n                  <button\n                    onClick={() => handleAnnotationDelete(annotation.id)}\n                    style={{\n                      marginTop: '0.25rem',\n                      padding: '0.25rem 0.5rem',\n                      backgroundColor: '#ff4444',\n                      color: 'white',\n                      border: 'none',\n                      borderRadius: '3px',\n                      fontSize: '0.8rem',\n                      cursor: 'pointer'\n                    }}\n                  >\n                    Delete\n                  </button>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Right Panel - Canvas */}\n      <div style={{ \n        flex: 1,\n        display: 'flex',\n        flexDirection: 'column',\n        height: '100%',\n        minWidth: 0\n      }}>\n        <div style={{ \n          marginBottom: '1rem',\n          padding: '0.75rem 1rem',\n          backgroundColor: '#e3f2fd',\n          borderRadius: '6px',\n          border: '1px solid #1976d2',\n          flexShrink: 0\n        }}>\n          <h2 style={{ margin: '0 0 0.5rem 0', color: '#1976d2' }}>\n            {currentImageData.filename}\n          </h2>\n          <p style={{ margin: 0, fontSize: '0.9rem', color: '#1565c0' }}>\n            Current tool: <strong>{selectedTool.replace('_', ' ').toUpperCase()}</strong> | Image: {currentImageData.width}Ã—{currentImageData.height}px\n          </p>\n        </div>\n\n        <div style={{\n          flex: 1,\n          overflow: 'auto',\n          minHeight: 0,\n          border: '1px solid #ddd',\n          borderRadius: '8px',\n          backgroundColor: '#f9f9f9'\n        }}>\n          <ImageCanvas\n            imageUrl={currentImageData.url}\n            annotations={annotations}\n            selectedTool={selectedTool}\n            onAnnotationCreate={handleAnnotationCreate}\n            onAnnotationUpdate={handleAnnotationUpdate}\n            onAnnotationDelete={handleAnnotationDelete}\n            onSamPointClick={handleSamPointClick}\n            samPoints={samPoints}\n            maskPoints={maskPoints}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default LabelingInterface; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}